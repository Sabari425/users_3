<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Users Management Dashboard">
    <meta name="keywords" content="users, dashboard, admin, responsive, boxicons">
    <meta name="author" content="Admin Dashboard">
    <title>Users - Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
                @import url('https://fonts.googleapis.com/css2?family=Poiret+One&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');

        :root {
            --primary-color: #3b82f6;
            --secondary-color: #6b7280;
            --bg-color: #ffffff;
            --text-color: #1f2937;
            --sidebar-bg: #1f2937;
            --sidebar-text: #ffffff;
        }

        [data-theme="dark"] {
            --bg-color: #1f2937;
            --text-color: #ffffff;
            --sidebar-bg: #111827;
            --sidebar-text: #d1d5db;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Roboto', sans-serif;
            transition: background-color 0.3s, color 0.3s;
            font-family: "Poppins", sans-serif;
            font-weight: 600;
            font-style: normal;
        }

        .sidebar {
            width: 250px;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            background-color: var(--sidebar-bg);
            color: var(--sidebar-text);
            transition: transform 0.3s ease, box-shadow 0.3s;
            border-top-right-radius: 1.25rem;
            border-bottom-right-radius: 1.25rem;
            box-shadow: 2px 0 16px rgba(0,0,0,0.08);
        }

        .sidebar.hidden {
            transform: translateX(-100%);
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--secondary-color);
            border-top-right-radius: 1.25rem;
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
            color: var(--sidebar-text);
            text-decoration: none;
            transition: background 0.3s, color 0.3s, transform 0.2s;
            border-radius: 0.75rem;
            margin: 0.25rem 1rem;
            font-weight: 500;
        }
        .sidebar-nav a:hover,
        .sidebar-nav a.bg-gray-700 {
            background: linear-gradient(90deg, var(--primary-color) 60%, var(--secondary-color) 100%);
            color: #fff;
            transform: scale(1.045);
            box-shadow: 0 2px 8px rgba(59,130,246,0.10);
        }

        .main-content {
            margin-left: 250px;
            padding: 2rem;
            transition: margin-left 0.3s ease, box-shadow 0.3s, background 0.3s;
            border-radius: 1.5rem;
            background: linear-gradient(120deg, #f0f4ff 0%, #f9fafb 100%);
            min-height: 100vh;
            box-shadow: 0 4px 24px rgba(59,130,246,0.04);
        }
        .main-content:hover, .main-content:focus-within {
            box-shadow: 0 8px 32px rgba(59,130,246,0.12);
            background: linear-gradient(120deg, #e0eaff 0%, #f3f6fd 100%);
        }

.activity-table th,
        .activity-table td,
        .metrics-table th,
        .metrics-table td,
        .users-table th,
        .users-table td,
        .settings-table th,
        .settings-table td,
        .login-table th,
        .login-table td {
            padding: 1rem;
            border: 1px solid var(--secondary-color);
            text-align: left;
            transition: background-color 0.3s, color 0.3s, transform 0.2s;
            border-radius: 0.5rem;
        }

        .activity-table th,
        .metrics-table th,
        .users-table th,
        .settings-table th,
        .login-table th {
            background-color: var(--primary-color);
            color: #ffffff;
            transition: background-color 0.3s, color 0.3s;
        }

        .activity-table tbody tr,
        .metrics-table tr,
        .users-table tr,
        .settings-table tr,
        .login-table tr {
            transition: background-color 0.2s, transform 0.2s, box-shadow 0.2s;
            border-radius: 0.5rem;
        }

        .activity-table tbody tr:hover,
        .activity-table tbody tr:focus,
        .metrics-table tr:hover,
        .users-table tr:hover,
        .settings-table tr:hover,
        .login-table tr:hover {
            background-color: rgba(59, 130, 246, 0.12);
            transform: scale(1.01) translateX(6px);
            box-shadow: 0 4px 16px rgba(59, 130, 246, 0.12);
            z-index: 1;
        }

        .card {
            background-color: var(--bg-color);
            border: 1px solid var(--secondary-color);
            border-radius: 1.25rem;
            padding: 1.5rem;
            transition: transform 0.3s, box-shadow 0.3s, border-color 0.3s;
            box-shadow: 0 2px 12px rgba(59,130,246,0.06);
        }
        .card:hover {
            transform: translateY(-8px) scale(1.035);
            box-shadow: 0 8px 24px rgba(59,130,246,0.15);
            border-color: var(--primary-color);
        }

        .users-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background-color: var(--bg-color);
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(59,130,246,0.05);
        }

        .users-table th,
        .users-table td {
            padding: 1rem;
            border: 1px solid var(--secondary-color);
            text-align: left;
            transition: background 0.2s, color 0.2s;
        }

        .users-table tr {
            transition: background 0.2s, transform 0.2s;
        }
        .users-table tr:hover {
            background: rgba(59,130,246,0.08);
            transform: scale(1.01);
        }

        .users-table th {
            background-color: var(--primary-color);
            color: #ffffff;
            border-top: none;
        }

        .search-bar input,
        .filter-select {
            padding: 0.5rem;
            border: 1px solid var(--secondary-color);
            border-radius: 0.5rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .search-bar input:focus,
        .filter-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(59,130,246,0.15);
            outline: none;
        }

        .edit-user {
            transition: background 0.2s, transform 0.2s, box-shadow 0.2s;
            border-radius: 0.5rem;
        }
        .edit-user:hover {
            background: var(--primary-color);
            color: #fff;
            transform: scale(1.08);
            box-shadow: 0 2px 8px rgba(59,130,246,0.12);
        }

        #theme-toggle {
            transition: background 0.2s, transform 0.2s;
            border-radius: 50%;
        }
        #theme-toggle:hover {
            background: var(--primary-color);
            color: #fff;
            transform: scale(1.1) rotate(10deg);
        }

        #toggle-sidebar {
            transition: color 0.2s, transform 0.2s;
            border-radius: 0.75rem;
        }
        #toggle-sidebar:hover {
            color: var(--primary-color);
            background: rgba(59,130,246,0.08);
            transform: scale(1.1);
        }

        .modal-content {
            background-color: var(--bg-color);
            padding: 2rem;
            border-radius: 1.25rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 8px 32px rgba(59,130,246,0.15);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .modal-content:focus-within {
            transform: scale(1.03);
            box-shadow: 0 16px 48px rgba(59,130,246,0.18);
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                border-radius: 0 1.25rem 1.25rem 0;
            }
            .sidebar.active {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
                border-radius: 1.25rem;
            }
        }

        @media (max-width: 480px) {
            .card {
                padding: 1rem;
                border-radius: 1rem;
            }
            .users-table th,
            .users-table td {
                padding: 0.5rem;
                font-size: 0.9rem;
            }
            .main-content {
                padding: 0.5rem;
                border-radius: 0.75rem;
            }
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .bx-spin {
            animation: spin 2s linear infinite;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }
    </style>
</head>

<body data-theme="light">
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2 class="text-xl font-bold">Admin Dashboard</h2>
        </div>
        <nav class="sidebar-nav">
            <a href="/dashboard"><i class="bx bx-home-alt mr-2"></i> Dashboard</a>
            <a href="/analytics"><i class="bx bx-bar-chart-alt-2 mr-2"></i> Analytics</a>
            <a href="/users" class="bg-gray-700"><i class="bx bx-user mr-2"></i> Users</a>
            <a href="/profile"><i class="bx bx-id-card mr-2"></i> Profile</a>
            <a href="/settings"><i class="bx bx-cog mr-2"></i> Settings</a>
            <a href="/logout"><i class="bx bx-log-out mr-2"></i> Logout</a>
        </nav>
    </aside>

    <main class="main-content">
        <header class="flex justify-between items-center mb-6">
            <div class="flex items-center">
                <button id="toggle-sidebar" class="text-2xl mr-4" aria-label="Toggle sidebar">
                    <i class="bx bx-menu"></i>
                </button>
                <h1 class="text-2xl font-bold">Automation & Robotics Users</h1>
            </div>
            <div class="flex items-center gap-4">
                <button id="theme-toggle" class="p-2 rounded-full bg-gray-200 dark:bg-[#23293a] text-gray-700 dark:text-yellow-300 border border-gray-300 dark:border-[#3b4252] shadow dark:shadow-lg transition-colors" aria-label="Toggle theme">
                    <i class="bx bx-moon"></i>
                <style>
                    [data-theme="dark"] .main-content {
                        background: linear-gradient(120deg, #23293a 0%, #1f2330 100%);
                        color: #e5e7eb;
                        box-shadow: 0 4px 24px rgba(30,41,59,0.18);
                    }
                    [data-theme="dark"] .main-content:hover, 
                    [data-theme="dark"] .main-content:focus-within {
                        background: linear-gradient(120deg, #23293a 0%, #23293a 100%);
                        box-shadow: 0 8px 32px rgba(30,41,59,0.28);
                    }
                    [data-theme="dark"] .card,
                    [data-theme="dark"] .modal-content {
                        background-color: #23293a;
                        color: #e5e7eb;
                        border-color: #374151;
                        box-shadow: 0 2px 12px rgba(30,41,59,0.18);
                    }
                    [data-theme="dark"] .users-table {
                        background-color: #23293a;
                        color: #e5e7eb;
                        border-color: #374151;
                        box-shadow: 0 2px 8px rgba(30,41,59,0.18);
                    }
                    [data-theme="dark"] .users-table th {
                        background-color: #2563eb;
                        color: #fff;
                    }
                    [data-theme="dark"] .users-table td {
                        background-color: #23293a;
                        color: #e5e7eb;
                        border-color: #374151;
                    }
                    [data-theme="dark"] .users-table tr:hover {
                        background: rgba(59,130,246,0.18);
                    }
                    [data-theme="dark"] .search-bar input,
                    [data-theme="dark"] .filter-select {
                        background-color: #23293a;
                        color: #e5e7eb;
                        border-color: #374151;
                    }
                    [data-theme="dark"] .search-bar input:focus,
                    [data-theme="dark"] .filter-select:focus {
                        border-color: #2563eb;
                        box-shadow: 0 0 0 2px rgba(37,99,235,0.25);
                    }
                    [data-theme="dark"] .edit-user {
                        background: #2563eb;
                        color: #fff;
                    }
                    [data-theme="dark"] .edit-user:hover {
                        background: #1e40af;
                        color: #fff;
                    }
                    [data-theme="dark"] .sidebar-header {
                        border-bottom: 1px solid #374151;
                    }
                    [data-theme="dark"] .sidebar-nav a {
                        color: #d1d5db;
                    }
                    [data-theme="dark"] .sidebar-nav a:hover,
                    [data-theme="dark"] .sidebar-nav a.bg-gray-700 {
                        background: linear-gradient(90deg, #2563eb 60%, #374151 100%);
                        color: #fff;
                    }
                    [data-theme="dark"] .bg-gray-200 {
                        background-color: #23293a !important;
                    }
                    [data-theme="dark"] .bg-gray-700 {
                        background-color: #374151 !important;
                    }
                    [data-theme="dark"] .text-gray-700 {
                        color: #e5e7eb !important;
                    }
                    [data-theme="dark"] .text-gray-400 {
                        color: #9ca3af !important;
                    }
                    [data-theme="dark"] .text-gray-500 {
                        color: #6b7280 !important;
                    }
                    [data-theme="dark"] .bg-gray-100 {
                        background-color: #23293a !important;
                        color: #e5e7eb !important;
                    }
                    [data-theme="dark"] .bg-green-500 {
                        background-color: #059669 !important;
                    }
                    [data-theme="dark"] .bg-blue-500 {
                        background-color: #2563eb !important;
                    }
                    [data-theme="dark"] .bg-red-500 {
                        background-color: #dc2626 !important;
                    }
                    [data-theme="dark"] .bg-blue-600 {
                        background-color: #1e40af !important;
                    }
                    [data-theme="dark"] .bg-red-600 {
                        background-color: #b91c1c !important;
                    }
                    [data-theme="dark"] .border-gray-300 {
                        border-color: #374151 !important;
                    }
                    [data-theme="dark"] .shadow {
                        box-shadow: 0 2px 12px rgba(30,41,59,0.18) !important;
                    }
                    [data-theme="dark"] pre {
                        background: #23293a !important;
                        color: #e5e7eb !important;
                    }
                    [data-theme="dark"] .modal {
                        background: rgba(17,24,39,0.85) !important;
                    }
                    [data-theme="dark"] .list-disc {
                        color: #bfc9d9;
                    }
                    /* Edit User Modal fields in dark mode */
                    [data-theme="dark"] #edit-user-modal input,
                    [data-theme="dark"] #edit-user-modal select {
                        background-color: #23293a;
                        color: #e5e7eb;
                        border-color: #374151;
                    }
                    [data-theme="dark"] #edit-user-modal input:focus,
                    [data-theme="dark"] #edit-user-modal select:focus {
                        border-color: #2563eb;
                        box-shadow: 0 0 0 2px rgba(37,99,235,0.25);
                    }
                    [data-theme="dark"] #edit-user-modal label {
                        color: #bfc9d9;
                    }
                    [data-theme="dark"] #edit-user-modal .bg-gray-500 {
                        background-color: #374151 !important;
                    }
                    [data-theme="dark"] #edit-user-modal .bg-blue-500 {
                        background-color: #2563eb !important;
                    }
                    [data-theme="dark"] #edit-user-modal .text-gray-400 {
                        color: #9ca3af !important;
                    }
                    [data-theme="dark"] #edit-user-modal .hover\:text-gray-700:hover {
                        color: #e5e7eb !important;
                    }
                    /* Add User Modal fields in dark mode */
                    [data-theme="dark"] #add-user-modal input,
                    [data-theme="dark"] #add-user-modal select {
                        background-color: #23293a;
                        color: #e5e7eb;
                        border-color: #374151;
                    }
                    [data-theme="dark"] #add-user-modal input:focus,
                    [data-theme="dark"] #add-user-modal select:focus {
                        border-color: #2563eb;
                        box-shadow: 0 0 0 2px rgba(37,99,235,0.25);
                    }
                    [data-theme="dark"] #add-user-modal label {
                        color: #bfc9d9;
                    }
                    [data-theme="dark"] #add-user-modal .bg-gray-500 {
                        background-color: #374151 !important;
                    }
                    [data-theme="dark"] #add-user-modal .bg-green-500 {
                        background-color: #059669 !important;
                    }
                    [data-theme="dark"] #add-user-modal .text-gray-400 {
                        color: #9ca3af !important;
                    }
                    [data-theme="dark"] #add-user-modal .hover\:text-gray-700:hover {
                        color: #e5e7eb !important;
                    }
                </style>
                <script>
                    // Add User Modal functionality
                    document.addEventListener('DOMContentLoaded', function () {
                        const addUserBtn = document.getElementById('add-user-btn');
                        const addUserModal = document.getElementById('add-user-modal');
                        const addUserForm = document.getElementById('add-user-form');
                        const closeAddModal = document.getElementById('close-add-modal');
                        const cancelAdd = document.getElementById('cancel-add');
                        // Show modal
                        addUserBtn.addEventListener('click', function () {
                            addUserModal.style.display = 'flex';
                            setTimeout(() => document.getElementById('add-name').focus(), 100);
                        });
                        // Hide modal
                        function closeAddUserModal() {
                            addUserModal.style.display = 'none';
                            addUserForm.reset();
                        }
                        closeAddModal.addEventListener('click', closeAddUserModal);
                        cancelAdd.addEventListener('click', closeAddUserModal);
                        addUserModal.addEventListener('mousedown', function (e) {
                            if (e.target === addUserModal) closeAddUserModal();
                        });
                        document.addEventListener('keydown', function (e) {
                            if (addUserModal.style.display === 'flex' && e.key === 'Escape') closeAddUserModal();
                        });
                        // Add user logic
                        addUserForm.addEventListener('submit', function (e) {
                            e.preventDefault();
                            const data = Object.fromEntries(new FormData(addUserForm));
                            let users = JSON.parse(localStorage.getItem('usersData')) || [];
                            const maxId = users.length ? Math.max(...users.map(u => u.id)) : 0;
                            const newUser = {
                                id: maxId + 1,
                                name: data.name,
                                email: data.email,
                                role: data.role,
                                status: data.status,
                                project: data.project
                            };
                            users.push(newUser);
                            localStorage.setItem('usersData', JSON.stringify(users));
                            // Re-render table if function exists
                            if (typeof renderUsersTable === 'function') renderUsersTable(users);
                            closeAddUserModal();
                            if (window.Toastify) {
                                Toastify({ text: "User added successfully!", duration: 2000, gravity: "top", position: "right", backgroundColor: "#22c55e" }).showToast();
                            } else {
                                alert('User added successfully!');
                            }
                            // Re-apply search and filters after add
                            if (document.getElementById('user-search')) document.getElementById('user-search').dispatchEvent(new Event('input'));
                            if (document.getElementById('role-filter')) document.getElementById('role-filter').dispatchEvent(new Event('change'));
                            if (document.getElementById('status-filter')) document.getElementById('status-filter').dispatchEvent(new Event('change'));
                        });
                    });
                </script>
                <button id="fullscreen-toggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700"
                    aria-label="Toggle fullscreen">
                    <i class="bx bx-fullscreen"></i>
                </button>
                <span id="header-name">Welcome, Admin</span>
            </div>
        </header>

        <section class="card mb-6">
            <div class="mb-4">
            <h2 class="text-lg font-semibold mb-2">About This Dashboard</h2>
            <p>
                This dashboard is designed for Automation and Robotics Engineering students, faculty, and their close contacts to manage users, track project teams, and monitor lab access. Use the filters and search to find students, professors, lab assistants, friends, family, or relatives. You can also edit user details such as their role (e.g., Student, Professor, Lab Assistant, Friend, Family, Relative) and status (e.g., Active, Inactive).
            </p>
            <ul class="list-disc ml-6 mt-2 text-sm text-gray-700">
                <li>Manage users involved in robotics projects, competitions, and research, as well as their friends and family.</li>
                <li>Track lab access and safety training status.</li>
                <li>Assign roles for project teams (e.g., Team Leader, Programmer, Mechanical Designer, Friend, Family, Relative).</li>
                <li>Monitor participation in workshops, seminars, and hackathons.</li>
            </ul>
            </div>
            <div class="flex flex-col md:flex-row gap-4 mb-4">
            <div class="search-bar flex-1">
                <label for="user-search" class="sr-only">Search users</label>
                <input type="text" id="user-search" placeholder="Search by name, project, or email..." class="w-full">
            </div>
            <select id="role-filter" class="filter-select">
                <option value="all">All Roles</option>
                <option value="Student">Student</option>
                <option value="Professor">Professor</option>
                <option value="Lab Assistant">Lab Assistant</option>
                <option value="Team Leader">Team Leader</option>
                <option value="Programmer">Programmer</option>
                <option value="Mechanical Designer">Mechanical Designer</option>
                <option value="Friend">Friend</option>
                <option value="Family">Family</option>
                <option value="Relative">Relative</option>
            </select>
            <select id="status-filter" class="filter-select">
                <option value="all">All Statuses</option>
                <option value="Active">Active</option>
                <option value="Inactive">Inactive</option>
                <option value="Lab Access">Lab Access</option>
                <option value="No Lab Access">No Lab Access</option>
            </select>
            <button id="add-user-btn" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 flex items-center gap-2">
                <i class="bx bx-plus"></i> Add User
            </button>
            </div>
            <table class="users-table">
            <thead>
                <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Status</th>
                <th>Project/Team</th>
                <th>Actions</th>
                </tr>
            </thead>
            <tbody id="users-table">
            </tbody>
            </table>
        </section>
        <!-- Add User Modal -->
        <div id="add-user-modal" class="modal fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50" style="display:none;">
            <div class="modal-content relative">
            <button type="button" id="close-add-modal" class="absolute top-2 right-2 text-gray-400 hover:text-gray-700 text-2xl" aria-label="Close modal">&times;</button>
            <h2 class="text-xl font-semibold mb-4">Add User</h2>
            <form id="add-user-form" autocomplete="off">
                <div class="mb-4">
                <label for="add-name" class="block mb-1">Name</label>
                <input type="text" id="add-name" name="name" required class="w-full border px-2 py-1 rounded">
                </div>
                <div class="mb-4">
                <label for="add-email" class="block mb-1">Email</label>
                <input type="email" id="add-email" name="email" required class="w-full border px-2 py-1 rounded">
                </div>
                <div class="mb-4">
                <label for="add-role" class="block mb-1">Role</label>
                <select id="add-role" name="role" class="w-full border px-2 py-1 rounded">
                    <option value="Student">Student</option>
                    <option value="Professor">Professor</option>
                    <option value="Lab Assistant">Lab Assistant</option>
                    <option value="Team Leader">Team Leader</option>
                    <option value="Programmer">Programmer</option>
                    <option value="Mechanical Designer">Mechanical Designer</option>
                    <option value="Friend">Friend</option>
                    <option value="Family">Family</option>
                    <option value="Relative">Relative</option>
                </select>
                </div>
                <div class="mb-4">
                <label for="add-status" class="block mb-1">Status</label>
                <select id="add-status" name="status" class="w-full border px-2 py-1 rounded">
                    <option value="Active">Active</option>
                    <option value="Inactive">Inactive</option>
                    <option value="Lab Access">Lab Access</option>
                    <option value="No Lab Access">No Lab Access</option>
                </select>
                </div>
                <div class="mb-4">
                <label for="add-project" class="block mb-1">Project/Team</label>
                <input type="text" id="add-project" name="project" placeholder="e.g., Maze Solver Bot" class="w-full border px-2 py-1 rounded">
                </div>
                <div class="flex justify-end gap-2">
                <button type="button" id="cancel-add" class="px-4 py-2 bg-gray-500 text-white rounded">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-green-500 text-white rounded">Add</button>
                </div>
            </form>
            </div>
        </div>
        <!-- Delete User Modal -->
        <div id="delete-user-modal" class="modal fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50" style="display:none;">
            <div class="modal-content relative">
            <button type="button" id="close-delete-modal" class="absolute top-2 right-2 text-gray-400 hover:text-gray-700 text-2xl" aria-label="Close modal">&times;</button>
            <h2 class="text-xl font-semibold mb-4">Delete User</h2>
            <p class="mb-4">Are you sure you want to delete this user?</p>
            <div class="flex justify-end gap-2">
            <button type="button" id="cancel-delete" class="px-4 py-2 bg-gray-500 text-white rounded">Cancel</button>
            <button type="button" id="confirm-delete" class="px-4 py-2 bg-red-600 text-black rounded">Delete</button>
            </div>
            </div>
        </div>
        <script>
            // --- Delete user logic ---
            let deleteUserId = null;
            let deleteUserRow = null;
            const deleteModal = document.getElementById('delete-user-modal');
            const confirmDeleteBtn = document.getElementById('confirm-delete');
            const cancelDeleteBtn = document.getElementById('cancel-delete');
            const closeDeleteModalBtn = document.getElementById('close-delete-modal');

            <button id="fullscreen-toggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700"
                    aria-label="Toggle fullscreen">
                    <i class="bx bx-fullscreen"></i>
                </button>
// --- Fullscreen Toggle ---
                            document.getElementById('fullscreen-toggle').onclick = function () {
                                if (!document.fullscreenElement) {
                                    document.documentElement.requestFullscreen();
                                } else {
                                    document.exitFullscreen();
                                }
                            };
            // Delegate delete button click
            document.addEventListener('click', function(e) {
            if (e.target.classList.contains('delete-user')) {
            deleteUserId = parseInt(e.target.dataset.id, 10);
            deleteUserRow = e.target.closest('tr');
            deleteModal.style.display = 'flex';
        }
        });

        function closeDeleteModal() {
            deleteModal.style.display = 'none';
            deleteUserId = null;
            deleteUserRow = null;
        }
        cancelDeleteBtn.onclick = closeDeleteModal;
        closeDeleteModalBtn.onclick = closeDeleteModal;
        deleteModal.addEventListener('mousedown', function(e) {
            if (e.target === deleteModal) closeDeleteModal();
        });
        document.addEventListener('keydown', function(e) {
            if (deleteModal.style.display === 'flex' && e.key === 'Escape') closeDeleteModal();
        });

        confirmDeleteBtn.onclick = function() {
            if (deleteUserId == null) return;
            // Remove from localStorage
            let users = JSON.parse(localStorage.getItem('usersData')) || [];
            users = users.filter(u => u.id !== deleteUserId);
            localStorage.setItem('usersData', JSON.stringify(users));
            // Re-render table
            if (typeof renderUsersTable === 'function') renderUsersTable(users);
            closeDeleteModal();
            if (window.Toastify) {
            Toastify({ text: "User deleted successfully!", duration: 2000, gravity: "top", position: "right", backgroundColor: "#ef4444" }).showToast();
            } else {
            alert('User deleted successfully!');
            }
            // Optionally re-apply search/filters
            if (document.getElementById('user-search')) document.getElementById('user-search').dispatchEvent(new Event('input'));
            if (document.getElementById('role-filter')) document.getElementById('role-filter').dispatchEvent(new Event('change'));
            if (document.getElementById('status-filter')) document.getElementById('status-filter').dispatchEvent(new Event('change'));
            };
        </script>

        <!-- Import Users Icon and Modal -->
        <button id="import-users-btn" title="Import Users from CSV" class="fixed bottom-8 right-8 bg-blue-600 text-white p-4 rounded-full shadow-lg hover:bg-blue-700 z-50 flex items-center justify-center">
            <i class="bx bx-import text-2xl"></i>
        </button>
        <input type="file" id="import-users-file" accept=".csv" style="display:none">

        <div id="import-users-modal" class="modal fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50" style="display:none;">
            <div class="modal-content relative">
            <button type="button" id="close-import-modal" class="absolute top-2 right-2 text-gray-400 hover:text-gray-700 text-2xl" aria-label="Close modal">&times;</button>
            <h2 class="text-xl font-semibold mb-4">Import Users from CSV</h2>
            <div class="mb-4">
            <p class="text-sm text-gray-700 mb-2">
            Upload a CSV file with columns: <b>Name, Email, Role, Status, Project/Team</b>.<br>
            <span class="text-xs text-gray-500">ID will be auto-generated. Example:</span>
            <pre class="bg-gray-100 p-2 rounded text-xs mt-1">Name,Email,Role,Status,Project/Team
        Alex Kim,alex.kim@university.edu,Student,Active,Robotics Arm Project
        ...</pre>
            </p>
            <input type="file" id="import-users-input" accept=".csv" class="block w-full mb-2">
            <div id="import-users-preview" class="text-xs text-gray-600 max-h-32 overflow-auto"></div>
            </div>
            <div class="flex justify-end gap-2">
            <button type="button" id="cancel-import" class="px-4 py-2 bg-gray-500 text-white rounded">Cancel</button>
            <button type="button" id="import-users-confirm" class="px-4 py-2 bg-blue-600 text-white rounded" disabled>Import</button>
            </div>
            </div>
        </div>

        <script>
        // Import Users Modal Logic
        const importBtn = document.getElementById('import-users-btn');
        const importModal = document.getElementById('import-users-modal');
        const importInput = document.getElementById('import-users-input');
        const importPreview = document.getElementById('import-users-preview');
        const importConfirm = document.getElementById('import-users-confirm');
        const importFileBtn = document.getElementById('import-users-file');
        let importData = [];
        // --- Fullscreen Toggle ---
                            document.getElementById('fullscreen-toggle').onclick = function () {
                                if (!document.fullscreenElement) {
                                    document.documentElement.requestFullscreen();
                                } else {
                                    document.exitFullscreen();
                                }
                            };
        // Show import modal
        importBtn.addEventListener('click', () => {
            importModal.style.display = 'flex';
            importInput.value = '';
            importPreview.innerHTML = '';
            importConfirm.disabled = true;
            importData = [];
        });

        // Close import modal
        function closeImportModal() {
            importModal.style.display = 'none';
            importInput.value = '';
            importPreview.innerHTML = '';
            importConfirm.disabled = true;
            importData = [];
        }
        document.getElementById('close-import-modal').onclick = closeImportModal;
        document.getElementById('cancel-import').onclick = closeImportModal;
        importModal.addEventListener('mousedown', function (e) {
            if (e.target === importModal) closeImportModal();
        });
        document.addEventListener('keydown', function (e) {
            if (importModal.style.display === 'flex' && e.key === 'Escape') closeImportModal();
        });

        // CSV parsing helper
        function parseCSV(text) {
            const lines = text.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            const rows = lines.slice(1).map(line => {
            // Handle quoted CSV
            const values = [];
            let val = '', inQuotes = false;
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"' && line[i + 1] === '"') {
                val += '"'; i++; // Escaped quote
                } else if (char === '"') {
                inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                values.push(val.trim()); val = '';
                } else {
                val += char;
                }
            }
            values.push(val.trim());
            const obj = {};
            headers.forEach((h, idx) => obj[h] = values[idx] || '');
            return obj;
            });
            return { headers, rows };
        }

        // Validate and preview CSV
        importInput.addEventListener('change', function () {
            const file = this.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function (e) {
            try {
                const text = e.target.result;
                const { headers, rows } = parseCSV(text);
                // Required columns
                const required = ['Name', 'Email', 'Role', 'Status', 'Project/Team'];
                const missing = required.filter(col => !headers.includes(col));
                if (missing.length) {
                importPreview.innerHTML = `<span class="text-red-600">Missing columns: ${missing.join(', ')}</span>`;
                importConfirm.disabled = true;
                importData = [];
                return;
                }
                // Show preview (first 5)
                let html = '<table class="w-full mb-2"><thead><tr>';
                required.forEach(col => html += `<th class="px-1">${col}</th>`);
                html += '</tr></thead><tbody>';
                rows.slice(0, 5).forEach(row => {
                html += '<tr>';
                required.forEach(col => html += `<td class="px-1">${row[col]}</td>`);
                html += '</tr>';
                });
                html += '</tbody></table>';
                if (rows.length > 5) html += `<span class="text-gray-400">...and ${rows.length - 5} more</span>`;
                importPreview.innerHTML = html;
                importConfirm.disabled = false;
                importData = rows;
            } catch (err) {
                importPreview.innerHTML = `<span class="text-red-600">Invalid CSV format.</span>`;
                importConfirm.disabled = true;
                importData = [];
            }
            };
            reader.readAsText(file);
        });

        // Import users from parsed CSV
        importConfirm.addEventListener('click', function () {
            if (!importData.length) return;
            // Get current users and max ID
            let users = JSON.parse(localStorage.getItem('usersData')) || [];
            let maxId = users.length ? Math.max(...users.map(u => u.id)) : 0;
            // Map and validate each row
            const validRoles = [
            "Student", "Professor", "Lab Assistant", "Team Leader", "Programmer", "Mechanical Designer", "Friend", "Family", "Relative"
            ];
            const validStatuses = [
            "Active", "Inactive", "Lab Access", "No Lab Access"
            ];
            let added = 0, skipped = 0;
            importData.forEach(row => {
            // Basic validation
            if (!row['Name'] || !row['Email'] || !row['Role'] || !row['Status']) { skipped++; return; }
            if (!validRoles.includes(row['Role'])) { skipped++; return; }
            if (!validStatuses.includes(row['Status'])) { skipped++; return; }
            // Prevent duplicate email
            if (users.some(u => u.email === row['Email'])) { skipped++; return; }
            users.push({
                id: ++maxId,
                name: row['Name'],
                email: row['Email'],
                role: row['Role'],
                status: row['Status'],
                project: row['Project/Team'] || ''
            });
            added++;
            });
            localStorage.setItem('usersData', JSON.stringify(users));
            // Re-render table
            if (typeof renderUsersTable === 'function') renderUsersTable(users);
            closeImportModal();
            if (window.Toastify) {
            Toastify({
                text: `Imported ${added} user(s). ${skipped ? skipped + ' skipped.' : ''}`,
                duration: 3000, gravity: "top", position: "right", backgroundColor: "#2563eb"
            }).showToast();
            } else {
            alert(`Imported ${added} user(s). ${skipped ? skipped + ' skipped.' : ''}`);
            }
            // Re-apply search and filters
            if (document.getElementById('user-search')) document.getElementById('user-search').dispatchEvent(new Event('input'));
            if (document.getElementById('role-filter')) document.getElementById('role-filter').dispatchEvent(new Event('change'));
            if (document.getElementById('status-filter')) document.getElementById('status-filter').dispatchEvent(new Event('change'));
        });

        // Keyboard shortcut: Alt+I to open import modal
        document.addEventListener('keydown', function (e) {
            if (e.altKey && e.key.toLowerCase() === 'i') {
            e.preventDefault();
            importBtn.click();
            }
        });
        </script>
        <script>
        // Default users data
        const defaultUsers = [
            { id: 1, name: "Alex Kim", email: "alex.kim@university.edu", role: "Student", status: "Active", project: "Robotics Arm Project" },
            { id: 2, name: "Dr. Priya Singh", email: "priya.singh@university.edu", role: "Professor", status: "Active", project: "Course Advisor" },
            { id: 3, name: "Maria Lopez", email: "maria.lopez@university.edu", role: "Lab Assistant", status: "Lab Access", project: "Robotics Lab" },
            { id: 4, name: "John Doe", email: "john.doe@university.edu", role: "Team Leader", status: "Active", project: "Autonomous Vehicle Team" },
            { id: 5, name: "Sara Chen", email: "sara.chen@university.edu", role: "Programmer", status: "Active", project: "Maze Solver Bot" },
            { id: 6, name: "Mohammed Al-Farsi", email: "mohammed.alfarsi@university.edu", role: "Mechanical Designer", status: "No Lab Access", project: "Robotic Gripper" },
            { id: 7, name: "Emily Zhang", email: "emily.zhang@university.edu", role: "Friend", status: "Active", project: "Support Team" },
            { id: 8, name: "Linda Kim", email: "linda.kim@university.edu", role: "Family", status: "Inactive", project: "Family Support" },
            { id: 9, name: "Carlos Rivera", email: "carlos.rivera@university.edu", role: "Relative", status: "Active", project: "Robotics Competition" },
            { id: 10, name: "Prof. David Lee", email: "david.lee@university.edu", role: "Professor", status: "Active", project: "Robotics Club Mentor" }
        ];

        // Load users from localStorage or use default
        function loadUsers() {
            const users = JSON.parse(localStorage.getItem('usersData'));
            return Array.isArray(users) && users.length ? users : defaultUsers;
        }

        // Save users to localStorage
        function saveUsers(users) {
            localStorage.setItem('usersData', JSON.stringify(users));
        }

        // Render users table
        function renderUsersTable(users) {
            const tbody = document.getElementById('users-table');
            tbody.innerHTML = '';
            users.forEach(user => {
            const tr = document.createElement('tr');
            tr.dataset.name = user.name;
            tr.dataset.role = user.role;
            tr.dataset.status = user.status;
            tr.innerHTML = `
                <td>${user.id}</td>
                <td>${user.name}</td>
                <td>${user.email}</td>
                <td>${user.role}</td>
                <td>${user.status}</td>
                <td>${user.project}</td>
                <td><button class="edit-user px-2 py-1 bg-blue-500 text-white rounded" data-id="${user.id}">Edit</button></td>
            `;
            tbody.appendChild(tr);
            });
        }

        // Get users and render on load
        let users = loadUsers();
        renderUsersTable(users);

        document.addEventListener('DOMContentLoaded', function () {
            const userSearch = document.getElementById('user-search');
            const usersTable = document.getElementById('users-table');
            const roleFilter = document.getElementById('role-filter');
            const statusFilter = document.getElementById('status-filter');
            const modal = document.getElementById('edit-user-modal');
        // Render users table
        function renderUsersTable(users) {
            const tbody = document.getElementById('users-table');
            tbody.innerHTML = '';
            users.forEach(user => {
                const tr = document.createElement('tr');
                tr.dataset.name = user.name;
                tr.dataset.role = user.role;
                tr.dataset.status = user.status;
                tr.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.role}</td>
                    <td>${user.status}</td>
                    <td>${user.project}</td>
                    <td>
                        <button class="edit-user px-2 py-1 bg-blue-500 text-white rounded" data-id="${user.id}">Edit</button>
                        <button class="delete-user px-2 py-1 bg-red-500 text-white rounded ml-2" data-id="${user.id}">Delete</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
            function applyFilters() {
            const role = roleFilter.value;
            const status = statusFilter.value;
            Array.from(usersTable.rows).forEach(row => {
                const rowRole = row.dataset.role;
                const rowStatus = row.dataset.status;
                const roleMatch = role === 'all' || rowRole === role;
                const statusMatch = status === 'all' || rowStatus === status;
                row.style.display = roleMatch && statusMatch ? '' : 'none';
            });
            }
            roleFilter.addEventListener('change', applyFilters);
            statusFilter.addEventListener('change', applyFilters);

            // Edit Modal
            usersTable.addEventListener('click', function (e) {
            if (e.target.classList.contains('edit-user')) {
                const button = e.target;
                const row = button.closest('tr');
                editingId = parseInt(button.dataset.id, 10);
                document.getElementById('edit-name').value = row.dataset.name;
                document.getElementById('edit-email').value = row.cells[2].textContent;
                document.getElementById('edit-role').value = row.dataset.role;
                document.getElementById('edit-status').value = row.dataset.status;
                document.getElementById('edit-project').value = row.cells[5].textContent;
                editForm.dataset.id = button.dataset.id;
                editingRow = row;
                modal.style.display = 'flex';
                setTimeout(() => document.getElementById('edit-name').focus(), 100);
            }
            });
            function closeEditModal() {
            modal.style.display = 'none';
            editingRow = null;
            editingId = null;
            }
            document.getElementById('cancel-edit').onclick = closeEditModal;
            document.getElementById('close-modal').onclick = closeEditModal;
            modal.addEventListener('mousedown', function (e) {
            if (e.target === modal) closeEditModal();
            });
            document.addEventListener('keydown', function (e) {
            if (modal.style.display === 'flex' && e.key === 'Escape') closeEditModal();
            });

            // Save edited user and persist to localStorage
            editForm.addEventListener('submit', function (e) {
            e.preventDefault();
            if (!editingRow || editingId == null) return;
            const data = Object.fromEntries(new FormData(editForm));
            // Update in-memory users array
            users = users.map(user =>
                user.id === editingId
                ? { ...user, name: data.name, email: data.email, role: data.role, status: data.status, project: data.project }
                : user
            );
            saveUsers(users);
            renderUsersTable(users);
            closeEditModal();
            if (window.Toastify) {
                Toastify({ text: "User updated successfully!", duration: 2000, gravity: "top", position: "right", backgroundColor: "#3b82f6" }).showToast();
            } else {
                alert('User updated successfully!');
            }
            // Re-apply search and filters after update
            userSearch.dispatchEvent(new Event('input'));
            applyFilters();
            });

            // Add User Modal logic
            addUserBtn.addEventListener('click', function () {
            addUserModal.style.display = 'flex';
            setTimeout(() => document.getElementById('add-name').focus(), 100);
            });
            function closeAddUserModal() {
            addUserModal.style.display = 'none';
            addUserForm.reset();
            }
            cancelAdd.onclick = closeAddUserModal;
            closeAddModal.onclick = closeAddUserModal;
            addUserModal.addEventListener('mousedown', function (e) {
            if (e.target === addUserModal) closeAddUserModal();
            });
            document.addEventListener('keydown', function (e) {
            if (addUserModal.style.display === 'flex' && e.key === 'Escape') closeAddUserModal();
            });

            // Add user and persist to localStorage
            addUserForm.addEventListener('submit', function (e) {
            e.preventDefault();
            const data = Object.fromEntries(new FormData(addUserForm));
            // Generate new unique ID
            const maxId = users.length ? Math.max(...users.map(u => u.id)) : 0;
            const newUser = {
                id: maxId + 1,
                name: data.name,
                email: data.email,
                role: data.role,
                status: data.status,
                project: data.project
            };
            users.push(newUser);
            saveUsers(users);
            renderUsersTable(users);
            closeAddUserModal();
            if (window.Toastify) {
                Toastify({ text: "User added successfully!", duration: 2000, gravity: "top", position: "right", backgroundColor: "#22c55e" }).showToast();
            } else {
                alert('User added successfully!');
            }
            // Re-apply search and filters after add
            userSearch.dispatchEvent(new Event('input'));
            applyFilters();
            });

            // Keyboard shortcut (Ctrl+K)
            document.addEventListener('keydown', function (e) {
            if (e.ctrlKey && e.key.toLowerCase() === 'k') {
                e.preventDefault();
                userSearch.focus();
            }
            });

            // Lazy loading animation (optional)
            if ('IntersectionObserver' in window) {
            const observer = new IntersectionObserver((entries, obs) => {
                entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    obs.unobserve(entry.target);
                }
                });
            }, { threshold: 0.1 });
            Array.from(usersTable.rows).forEach(row => observer.observe(row));
            }
        });
        </script>

        <!-- Edit User Modal -->
        <div id="edit-user-modal" class="modal fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50" style="display:none;">
            <div class="modal-content relative">
                <button type="button" id="close-modal" class="absolute top-2 right-2 text-gray-400 hover:text-gray-700 text-2xl" aria-label="Close modal">&times;</button>
                <h2 class="text-xl font-semibold mb-4">Edit User</h2>
                <form id="edit-user-form" autocomplete="off">
                    <div class="mb-4">
                        <label for="edit-name" class="block mb-1">Name</label>
                        <input type="text" id="edit-name" name="name" required class="w-full border px-2 py-1 rounded">
                    </div>
                    <div class="mb-4">
                        <label for="edit-email" class="block mb-1">Email</label>
                        <input type="email" id="edit-email" name="email" required class="w-full border px-2 py-1 rounded">
                    </div>
                    <div class="mb-4">
                        <label for="edit-role" class="block mb-1">Role</label>
                        <select id="edit-role" name="role" class="w-full border px-2 py-1 rounded">
                            <option value="Student">Student</option>
                            <option value="Professor">Professor</option>
                            <option value="Lab Assistant">Lab Assistant</option>
                            <option value="Team Leader">Team Leader</option>
                            <option value="Programmer">Programmer</option>
                            <option value="Mechanical Designer">Mechanical Designer</option>
                            <option value="Friend">Friend</option>
                            <option value="Family">Family</option>
                            <option value="Relative">Relative</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="edit-status" class="block mb-1">Status</label>
                        <select id="edit-status" name="status" class="w-full border px-2 py-1 rounded">
                            <option value="Active">Active</option>
                            <option value="Inactive">Inactive</option>
                            <option value="Lab Access">Lab Access</option>
                            <option value="No Lab Access">No Lab Access</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="edit-project" class="block mb-1">Project/Team</label>
                        <input type="text" id="edit-project" name="project" placeholder="e.g., Maze Solver Bot" class="w-full border px-2 py-1 rounded">
                    </div>
                    <div class="flex justify-end gap-2">
                        <button type="button" id="cancel-edit"
                            class="px-4 py-2 bg-gray-500 text-white rounded">Cancel</button>
                        <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <script src="https://unpkg.com/boxicons@2.1.3/dist/boxicons.js"></script>
    <script>
        // Load profile data for header
        const defaultProfile = { name: "Admin" };
        function loadHeaderName() {
            const profileData = JSON.parse(localStorage.getItem('profileData')) || defaultProfile;
            document.querySelector('#header-name').textContent = `Welcome, ${profileData.name}`;
        }

        // Sidebar toggle
        const toggleSidebar = document.querySelector('#toggle-sidebar');
        const sidebar = document.querySelector('.sidebar');
        const mainContent = document.querySelector('.main-content');
        toggleSidebar.addEventListener('click', () => {
            sidebar.classList.toggle('hidden');
            if(window.innerWidth <= 768) {
                sidebar.classList.toggle('active');
            }
        });

        // Theme toggle
        const themeToggle = document.querySelector('#theme-toggle');
        themeToggle.addEventListener('click', () => {
            const currentTheme = document.body.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.body.setAttribute('data-theme', newTheme);
            themeToggle.querySelector('i').classList.toggle('bx-moon', newTheme === 'light');
            themeToggle.querySelector('i').classList.toggle('bx-sun', newTheme === 'dark');
            localStorage.setItem('theme', newTheme);
        });

        // Load theme
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            document.body.setAttribute('data-theme', savedTheme);
            themeToggle.querySelector('i').classList.toggle('bx-moon', savedTheme === 'light');
            themeToggle.querySelector('i').classList.toggle('bx-sun', savedTheme === 'dark');
        }

        // User search (searches name, email, and project/team)
        const userSearch = document.querySelector('#user-search');
        userSearch.addEventListener('input', () => {
            const query = userSearch.value.toLowerCase();
            document.querySelectorAll('#users-table tr').forEach(row => {
                const name = row.dataset.name.toLowerCase();
                const email = row.cells[2].textContent.toLowerCase();
                const project = row.cells[5].textContent.toLowerCase();
                row.style.display = (name.includes(query) || email.includes(query) || project.includes(query)) ? '' : 'none';
            });
        });

        // Role and status filters
        const roleFilter = document.querySelector('#role-filter');
        const statusFilter = document.querySelector('#status-filter');
        function applyFilters() {
            const role = roleFilter.value;
            const status = statusFilter.value;
            document.querySelectorAll('#users-table tr').forEach(row => {
                const rowRole = row.dataset.role;
                const rowStatus = row.dataset.status;
                const roleMatch = role === 'all' || rowRole === role;
                const statusMatch = status === 'all' || rowStatus === status;
                row.style.display = roleMatch && statusMatch ? '' : 'none';
            });
        }
        roleFilter.addEventListener('change', applyFilters);
        statusFilter.addEventListener('change', applyFilters);

        // Edit user modal
        const modal = document.querySelector('#edit-user-modal');
        const editForm = document.querySelector('#edit-user-form');
        const cancelEdit = document.querySelector('#cancel-edit');
        const closeModal = document.querySelector('#close-modal');
        let editingRow = null;

        function openEditModal(row, id) {
            document.querySelector('#edit-name').value = row.dataset.name;
            document.querySelector('#edit-email').value = row.cells[2].textContent;
            document.querySelector('#edit-role').value = row.dataset.role;
            document.querySelector('#edit-status').value = row.dataset.status;
            document.querySelector('#edit-project').value = row.cells[5].textContent;
            editForm.dataset.id = id;
            editingRow = row;
            modal.style.display = 'flex';
            setTimeout(() => {
                document.querySelector('#edit-name').focus();
            }, 100);
        }

        document.querySelectorAll('.edit-user').forEach(button => {
            button.addEventListener('click', () => {
                const id = button.dataset.id;
                const row = button.closest('tr');
                openEditModal(row, id);
            });
        });

        function closeEditModal() {
            modal.style.display = 'none';
            editingRow = null;
        }

        cancelEdit.addEventListener('click', closeEditModal);
        closeModal.addEventListener('click', closeEditModal);

        // Close modal on ESC
        document.addEventListener('keydown', (e) => {
            if (modal.style.display === 'flex' && e.key === 'Escape') {
                closeEditModal();
            }
        });

        // Save edited user
        editForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const id = editForm.dataset.id;
            const data = Object.fromEntries(new FormData(editForm));
            if (!editingRow) return;
            editingRow.dataset.name = data.name;
            editingRow.dataset.role = data.role;
            editingRow.dataset.status = data.status;
            editingRow.cells[1].textContent = data.name;
            editingRow.cells[2].textContent = data.email;
            editingRow.cells[3].textContent = data.role;
            editingRow.cells[4].textContent = data.status;
            editingRow.cells[5].textContent = data.project;
            closeEditModal();
            // Optionally show a toast instead of alert
            if (window.Toastify) {
                Toastify({ text: "User updated successfully!", duration: 2000, gravity: "top", position: "right", backgroundColor: "#3b82f6" }).showToast();
            } else {
                alert('User updated successfully!');
            }
        });

        // Lazy loading for users table (adds 'visible' class for animation)
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('#users-table tr').forEach(row => {
            observer.observe(row);
        });

        // Keyboard shortcut (Ctrl + K)
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key.toLowerCase() === 'k') {
                e.preventDefault();
                userSearch.focus();
            }
        });

        // Click outside modal to close
        modal.addEventListener('mousedown', function(e) {
            if (e.target === modal) closeEditModal();
        });

        // Responsive sidebar close on link click (mobile)
        document.querySelectorAll('.sidebar-nav a').forEach(link => {
            link.addEventListener('click', () => {
                if(window.innerWidth <= 768) {
                    sidebar.classList.add('hidden');
                    sidebar.classList.remove('active');
                }
            });
        });

        document.addEventListener('DOMContentLoaded', loadHeaderName);
    </script>
    <!-- Optional: Toastify for better notifications -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
</body>

</html>